<body> 
<div class = "carts_card">
<p class = "menu_style"><%= link_to "Menu", view_user_path, class:"BarComponentsRuby"%>
  <%= link_to "My Orders", orders_path, class:"BarComponentsRuby"%>
  <%= link_to "Cart", carts_path, class:"BarComponentsRuby"%>
  <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSKGxujYqqoJ2wjE-cUDwfmfhjX-ls8t7TAcwcfgjd5LspLpQnT7-pXfP_pVapr9qF1kZQ&usqp=CAU" class = "cart_image" >
  <% c=0%>
  <% model_user(Cart).each do |cart|%>
    <% cart.count%>
    <%c=c+cart.count%>
  <% end %>
  <% if c!=0%>
     <%= c%>
  <% end %>
  <input type = "image" class = "notification_image" src="https://icones.pro/wp-content/uploads/2022/02/icone-de-cloche-grise.png"  onclick="notificationToggle();">
   <%= method_status("Delivered").count %>
  <div class = "notification_action">
   <div class = "NotificationToggle">
   <% method_status("Delivered").each do |del|%>
   <section class = "display_css">
   <p>Order no: #<%= del.id %> was Delivered?</p>
   <%= button_to "Yes", "/orders/#{del.id}", method: "put", class:"YesHeader"%>
   </section>
   <%end%>
  </div>
  </p>
  <script>
     function notificationToggle(){
        const toggleMenu = document.querySelector('.NotificationToggle');
        toggleMenu.classList.toggle('active')
     }
  </script>

  <br>
  <hr>
<div class = "main_card">
<section class = "width">
  <p class = "SidebarComponents"> <%= link_to "All Orders", orders_path, class:"orders_sidebarcomponents"%></p>
 <p class = "SidebarComponents"> <%= link_to "Active Orders", user_active_orders_path, class:"orders_sidebarcomponents"%></p>
  <p class = "SidebarComponents"><%= link_to "Completed Orders", user_completed_orders_path, class:"orders_sidebarcomponents"%></p>
</section>
<section class = "style_card">
<%=form_with(url:"/user_completed_orders"  , method: "get")  do |form| %>
   <%= form.select :status_almost, ["Delivered", "Confirm Success"],{:prompt=>"Choose status",:selected=>params[:status_almost]},{class:"status",:onchange=>"this.form.submit()"}%>
<% end %>
<% if params[:status_almost].blank?%>
  <% orders_completed = method_completed_orders.cachemethod.sort_by(&:updated_at).reverse%>
<% else %>
   <% orders_completed = model_user(Order).where(status: params[:status_almost])%>
   <% orders_completed = model_user_reverse(orders_completed) %>
   <% orders_completed = Order.cache(orders_completed)%>
<% end %>
<% orders_completed.each do |order|%>
    <div class = "main_card_orders">
     <br>
      <section class = "parllel">
        <p class = "OrderNo">Order Id: #<%= order.id %></p>
        <p class = "name">Status: <%= order.status %></p>
      </section>
      <section class = "display">
      <p class = "user_name"><%= current_user.name%> - </p> 
      <p class = "mobile_no"><%= current_user.mobile_no %></p>
      </section>
      <section class = "date_style">
      <p class = "on"> Orderd on: </p>
      <img src="https://www.shutterstock.com/image-illustration/calendar-icon-isolated-date-line-600w-1055897141.jpg" class = "date_image">
      <p class = "date"><%= order.created_at.in_time_zone("Chennai").strftime("%b %d, %Y at %l:%M %p")%></p>
      </section>
      <section class = "date_style">
      <p class = "on"> Delivered on: </p>
      <img src="https://www.shutterstock.com/image-illustration/calendar-icon-isolated-date-line-600w-1055897141.jpg" class = "date_image">
      <p class = "date"><%= order.updated_at.in_time_zone("Chennai").strftime("%b %d, %Y at %l:%M %p")%></p>
      </section>
      <p class = "items">Items: </p>
      <p class = "menu">
      <% cost=0 %>
      <% order.menu.split("+") do |o| %>
       <br>
       <br>
        <% str= o.split("*")%>
        <%= str[0]%>
        &nbsp;&nbsp;&nbsp;&nbsp;<%= "X "+str[1]%>
        <% cost=str[2].to_i+cost%>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%= str[2]+" ₹"%>
      <%end%>
      <br>
      </p>
      <p class = "Total_cost">Total: &nbsp;&nbsp;<%= cost.to_s+" ₹"%></p>
      
</div>

<% end %>
</section>
      